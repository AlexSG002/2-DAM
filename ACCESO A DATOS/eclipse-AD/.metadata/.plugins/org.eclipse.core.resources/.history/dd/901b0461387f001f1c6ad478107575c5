package productos;

import java.io.File;
import java.io.IOException;
import java.io.RandomAccessFile;
import java.util.Scanner;

public class Principal {
	
	static String fichdep = (".\\Productos.dat");
	static int LON = 72;

	public static void main(String[] args) throws IOException {
		Scanner sc = new Scanner(System.in);
		int opcion = 0;

		do {
			mostrarMenu();
			opcion = sc.nextInt();
			switch (opcion) {
			case 1:
				ejercicio1();
				break;
			case 2:
				ejercicio2();
				break;
			case 3:
				
				break;
			case 4:
				
				break;
			case 5:
				System.out.println("Adios!");
				break;
			default:
				System.out.println("Seleccione una opción válida!");
				break;
			}
		} while (opcion != 5);

		sc.close();
	}


	private static void ejercicio4() throws IOException {
		

	}

	private static void ejercicio3() throws IOException {
		int codigoPro=0;
		int uniVen = 0;
		String fecha;
		File fichero = new File(".\\DatosdeVentas.dat");
		File productos = new File(".\\Productos.dat");
		System.out.println("LISTADO DE VENTAS");
		System.out.println("------------------------------------------------------");
		System.out.printf("%6s %17s %10s %n","CODIGO","UNIDADES VENDIDAS","FECHA");
		System.out.printf("%6s %17s %10s %n","------","-----------------", "----------");
		
		RandomAccessFile file = new RandomAccessFile(fichero, "r");
		RandomAccessFile fiprod = new RandomAccessFile(productos, "rw");
		int posicion = 0; // para situarnos al principio
		int posicionProd = 0;
		int lon=28;
		int lonProd=46;
		for (;;) { // recorro el fichero
			file.seek(posicion); // nos posicionamos en posicion
			codigoPro = file.readInt();
			uniVen = file.readInt();
			//Comprobar que esté entre 1 y 99
			if (codigoPro <1 || codigoPro>99) {
				System.out.println("ERROR, CÓDIGO DE PRODUCTO ERRÓNEO, NO ESTÁ ENTRE 1 Y 99: "+codigoPro);
			}else {
			//Comprobar si el código existe en productos
			posicionProd = (codigoPro-1) * lonProd;
			fiprod.seek(posicionProd); // nos posicionamos en posicion
			int codPro = fiprod.readInt();
			if(codPro == codigoPro) {
				//Localizado se actualiza
				System.out.println("Localizado producto: "+codigoPro+", se actualiza");
			}else {
			
				System.out.println("No localizado el producto: "+codigoPro+" es hueco");
			}
			}
				posicion = posicion + lon;
				if(posicion>=file.length())
					break;
			}
			file.close();
			fiprod.close();
		} //fin for
	private static void ejercicio2() throws IOException {
		int codigoPro=0;
		int uniVen = 0;
		String fecha;
		File fichero = new File(".\\DatosdeVentas.dat");
		System.out.println("LISTADO DE VENTAS");
		System.out.println("------------------------------------------------------");
		System.out.printf("%6s %17s %10s %n","CODIGO","UNIDADES VENDIDAS","FECHA");
		System.out.printf("%6s %17s %10s %n","------","-----------------", "----------");
		
		RandomAccessFile file = new RandomAccessFile(fichero, "r");
		int posicion = 0; // para situarnos al principio
		int lon=28;
		for (;;) { // recorro el fichero
			file.seek(posicion); // nos posicionamos en posicion
			codigoPro = file.readInt();
			uniVen = file.readInt();	
			fecha="";
			System.out.printf("%6s %17s %10s %n", codigoPro, uniVen, fecha);
			for(int i=0; i>=10;i++) {
				fecha = fecha + file.readChar();
			}
				posicion = posicion + lon;
				if(posicion>=file.length())
					break;
			}
			
		} //fin for



	private static void ejercicio1() throws IOException {
		int codigoPro=0;
		double pvp = 0;
		String nombrePro;
		int existencias;
		File fichero = new File(".\\Productos.dat");
		System.out.println("LISTADO DE PRODUCTOS");
		System.out.println("-----------------------------------------");
		System.out.printf("%6s %-30s %12s %10s %n","CODIGO","NOMBRE","EXISTENCIAS","PVP");
		System.out.printf("%6s %-30s %12s %10s %n","------","------------------------------","------------","----------");
		
		RandomAccessFile file = new RandomAccessFile(fichero, "r");
		int posicion = 0; // para situarnos al principio
		int lonProd=46;
		for (;;) { // recorro el fichero
			file.seek(posicion); // nos posicionamos en posicion
			codigoPro = file.readInt();
			if(codigoPro!=0) {
				//leer resto y visualizar
				nombrePro="";
				for (int i=0; i<15; i++) {
					nombrePro = nombrePro+file.readChar();
				}
				existencias=file.readInt();
				pvp=file.readDouble();
				System.out.printf("%6s %-30s %12s %10s %n", codigoPro, nombrePro, existencias, pvp);
			}
			posicion = posicion + lonProd;
			if(posicion>=file.length())
				break;
		} //fin for
	}

	private static void mostrarMenu() {
		System.out.println("------------------------------------------------------");
		System.out.println("OPERACIONES CON ALUMNOS");
		System.out.println("  1. Ejercicio 1. Listar productos");
		System.out.println("  2. Ejercicio 2. Listar ventas");
		System.out.println("  3. Ejercicio 3. Actualizar");
		System.out.println("  4. Ejercicio 4. Crear XML");
		System.out.println("  5. Salir");
		System.out.println("------------------------------------------------------");
	}
}
